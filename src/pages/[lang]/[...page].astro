---
import PostPage from '@components/PostPage.astro'
import Pagination from '@components/control/Pagination.astro'
import { PAGE_SIZE } from '@constants/constants'
import { DEFAULT_LOCALE, SUPPORTED_LOCALES } from '@i18n/translation'
import MainGridLayout from '@layouts/MainGridLayout.astro'
import { getSortedPostsForLang } from '@utils/content-utils'
import type { GetStaticPaths } from 'astro'

export async function getStaticPaths({
  paginate,
}: Parameters<GetStaticPaths>[0]) {
  const paths = []
  const nonDefaultLocales = SUPPORTED_LOCALES.filter(
    lang => lang !== DEFAULT_LOCALE,
  )

  for (const lang of nonDefaultLocales) {
    const posts = await getSortedPostsForLang(lang)
    const paginated = paginate(posts, {
      pageSize: PAGE_SIZE,
      params: { lang },
    })
    paths.push(...paginated)
  }
  return paths
}

const { page } = Astro.props
const { lang } = Astro.params

const len = page.data.length
---

<MainGridLayout lang={lang}>
    <PostPage page={page}></PostPage>
    <Pagination class="mx-auto onload-animation" page={page} style=`animation-delay: calc(var(--content-delay) + ${(len)*50}ms)`></Pagination>
</MainGridLayout>
