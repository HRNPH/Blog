---
import ArchivePanel from '@components/ArchivePanel.astro'
import I18nKey from '@i18n/i18nKey'
import {
  DEFAULT_LOCALE,
  i18n,
  SUPPORTED_LOCALES,
} from '@i18n/translation'
import MainGridLayout from '@layouts/MainGridLayout.astro'
import { getSortedPostsForLang } from '@utils/content-utils'

export async function getStaticPaths() {
  const paths = []
  const nonDefaultLocales = SUPPORTED_LOCALES.filter(
    (lang) => lang !== DEFAULT_LOCALE,
  )

  for (const lang of nonDefaultLocales) {
    const posts = await getSortedPostsForLang(lang)
    const allTags = posts.reduce<Set<string>>((acc, post) => {
      post.data.tags.forEach((tag: string) => acc.add(tag))
      return acc
    }, new Set())

    for (const tag of allTags) {
      paths.push({
        params: { lang, tag },
      })
    }
  }

  return paths
}

const { lang } = Astro.params
const tag = Astro.params.tag as string
---

<MainGridLayout title={i18n(I18nKey.archive, lang)} description={i18n(I18nKey.archive, lang)} lang={lang}>
    <ArchivePanel tags={[tag]} lang={lang}></ArchivePanel>
</MainGridLayout>
